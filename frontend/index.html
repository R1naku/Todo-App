<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f0f2f5; margin: 0; }
    .container { max-width: 500px; margin: 0 auto; background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
    h2 { text-align: center; color: #0088cc; margin-bottom: 20px; }
    input { padding: 14px; margin: 10px 0; width: 100%; box-sizing: border-box; font-size: 16px; border-radius: 12px; border: 1px solid #ddd; }
    button { padding: 14px; width: 100%; background: #0088cc; color: white; border: none; border-radius: 12px; font-size: 16px; cursor: pointer; transition: 0.3s; }
    button:hover { background: #006ba6; }
    #result { margin-top: 25px; padding: 20px; border: 1px solid #ddd; border-radius: 12px; background: #fafafa; text-align: center; min-height: 120px; }
    .error { color: #d32f2f; font-weight: bold; font-size: 18px; }
    .avatar { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid #0088cc; margin-bottom: 15px; }
    .info { font-size: 18px; line-height: 1.6; }
    .loading { color: #0088cc; font-style: italic; }
  </style>
</head>
<body>
  <div class="container">
    <h2>üîç –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram</h2>
    <input type="text" id="username" placeholder="–í–≤–µ–¥–∏—Ç–µ @username –∏–ª–∏ ID" />
    <button onclick="searchUser()">–ù–∞–π—Ç–∏</button>
    <div id="result"></div>
  </div>

  <script>
    // ‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê –ò–ó–ú–ï–ù–ò –≠–¢–£ –°–¢–†–û–ß–ö–£ –ù–ê –°–ê–ú–´–ô –°–í–ï–ñ–ò–ô NGROK ‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê‚Üê
    const API_BASE = "https://b276-50-7-249-66.ngrok-free.app"; // ‚Üê –≤—Å—Ç–∞–≤—å –Ω–æ–≤—ã–π –∏–∑ localhost:4041

    async function searchUser() {
      const resultDiv = document.getElementById("result");
      const username = document.getElementById("username").value.trim().replace(/^@/, "");

      if (!username) {
        resultDiv.innerHTML = '<p class="error">–í–≤–µ–¥–∏—Ç–µ username –∏–ª–∏ ID</p>';
        return;
      }

      resultDiv.innerHTML = '<p class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</p>';

      try {
        const url = `${API_BASE}/tg/info/${encodeURIComponent(username)}`;
        console.log("–ó–∞–ø—Ä–æ—Å:", url);

        const initData = window.Telegram?.WebApp?.initData || "";
        console.log("initData length:", initData.length);

        const response = await fetch(url, {
          method: "GET",
          headers: {
            "X-Telegram-Init-Data": initData
          }
        });

        console.log("–°—Ç–∞—Ç—É—Å:", response.status);

        const text = await response.text(); // ‚Üê —Å–Ω–∞—á–∞–ª–∞ –±–µ—Ä—ë–º –∫–∞–∫ —Ç–µ–∫—Å—Ç
        console.log("–°—ã—Ä–æ–π –æ—Ç–≤–µ—Ç:", text.substring(0, 200) + "...");

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${text.substring(0, 100)}`);
        }

        const data = JSON.parse(text);
        console.log("–î–∞–Ω–Ω—ã–µ:", data);

        resultDiv.innerHTML = `
          <img src="${data.avatar_url ? API_BASE + data.avatar_url : 'https://via.placeholder.com/100?text=üòä'}" class="avatar" alt="–ê–≤–∞—Ç–∞—Ä">
          <div class="info">
            <h3>${data.first_name || '‚Äî'} ${data.last_name || ''}</h3>
            <p><strong>Username:</strong> ${data.username ? '@' + data.username : '–Ω–µ—Ç'}</p>
            <p><strong>ID:</strong> ${data.id}</p>
          </div>
        `;
      } catch (err) {
        console.error("–û—à–∏–±–∫–∞:", err);
        resultDiv.innerHTML = `<p class="error">–û—à–∏–±–∫–∞: ${err.message}</p>`;
      }
    }

    // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
    window.onload = () => {
      const user = window.Telegram?.WebApp?.initDataUnsafe?.user;
      if (user) {
        document.getElementById("username").value = user.username || user.id;
        searchUser();
      } else {
        document.getElementById("result").innerHTML = '<p class="error">–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram</p>';
      }
    };
  </script>
</body>
</html>